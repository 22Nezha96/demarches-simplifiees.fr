%div#first-block
  %div.infos
    %div.projet-name #{@facade.dossier.nom_projet.capitalize rescue nil}
    #dossier_id= t('dynamics.dossiers.numéro') + @facade.dossier.id.to_s

%div#action-block
  - if gestionnaire_signed_in?
    - if !@facade.dossier.read_only?
      = form_tag(url_for({controller: 'backoffice/dossiers', action: :valid, dossier_id: @facade.dossier.id}), class: 'form-inline', method: 'POST') do
        %button.action{'data-toggle' => :tooltip, title: 'En cliquant ici, vous figez le dossier et autorisez le dépôt du dossier pour instruction.'}
          = 'Déclarer complet'.upcase
    - elsif @facade.dossier.submitted?
      = form_tag(url_for({controller: 'backoffice/dossiers', action: :receive, dossier_id: @facade.dossier.id}), class: 'form-inline', method: 'POST') do
        %button.action
          = 'Accuser réception'.upcase
    - elsif @facade.dossier.received?
      = form_tag(url_for({controller: 'backoffice/dossiers', action: :close, dossier_id: @facade.dossier.id}), class: 'form-inline action_button', method: 'POST', style: 'display:inline', 'data-toggle' => :tooltip, title: 'Accepter') do
        %button.action
          %i.fa.fa-check
      = form_tag(url_for({controller: 'backoffice/dossiers', action: :refuse, dossier_id: @facade.dossier.id}), class: 'form-inline action_button', method: 'POST', style: 'display:inline', 'data-toggle' => :tooltip, title: 'Refuser') do
        %button.action
          %i.fa.fa-times
      = form_tag(url_for({controller: 'backoffice/dossiers', action: :without_continuation, dossier_id: @facade.dossier.id}), class: 'form-inline action_button', method: 'POST', style: 'display:inline', 'data-toggle' => :tooltip, title: 'Classer sans suite') do
        %button.action
          %i.fa.fa-circle-o

%div#menu-block

%div#infos-block
  %div.split-hr-left
  %div.dossier-state= @facade.dossier.display_state
  %div.split-hr-left
  %div.notifications
    - if @facade.dossier.notifications.empty?
      = "Aucune notification pour le moment."
    - else
      %i.fa.fa-bell-o
      - @facade.dossier.notifications.limit(5).each do |notification|
        .notification
          .updated-at= notification.updated_at.strftime('%d/%m/%Y %H:%M')
          - if ['champs', 'piece_justificative'].include?(notification.type_notif)
            - if notification.liste.size > 1
              .type= "Plusieurs attributs ont été changés, dont: #{notification.liste.join(" ")}"
            - else
              .type= "Un attribut à été changé: #{notification.liste.last}"
          - else
            .type= notification.liste.last
          .split-hr
